<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/add-store.css">
    <title>Dream Restaurants</title>
</head>

<body>
    <h1>Dream Restaurants</h1>

    <div class="content">
        <form id="add-restaurant-form">

            <input type="text" id="Restaurant_Name" placeholder="Restaurant Name" required>
            <input type="text" id="Address" placeholder="Address" required>
            <input type="text" id="Phone_Number" placeholder="Phone Number" required>
            <input type="text" id="Email" placeholder="Email" required>
            <input type="text" id="Opening_Hours" placeholder="Opening Hours" required>
            <input type="text" id="Cuisine_Type" placeholder="Cuisine Type" required>
            <input type="text" id="Dietary_Options" placeholder="Dietary Options" required>
            <input type="text" id="Service_Type" placeholder="Service Type" required>
            <input type="text" id="Comments" placeholder="Comments" required>

            <button type="submit">Add Restaurant</button>
        </form>

        <ul id="restaurant-list"></ul>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-analytics.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC30Yz7Zct6gpTgFHCbVPDYVI2cTglkPmI",
            authDomain: "food-4206b.firebaseapp.com",
            databaseURL: "https://food-4206b-default-rtdb.firebaseio.com",
            projectId: "food-4206b",
            storageBucket: "food-4206b.appspot.com",
            messagingSenderId: "1056463919710",
            appId: "1:1056463919710:web:d453c55df200e115d972cf",
            measurementId: "G-PDP3EZH9T8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // Initialize Firestore
        const db = getFirestore(app);
        const foodCollection = collection(db, 'Food');

        const restaurantList = document.querySelector('#restaurant-list');
        const form = document.querySelector('#add-restaurant-form');

        function renderStorePage(doc) {
            let li = document.createElement('li');
            let Restaurant_Name = document.createElement('span');
            let Address = document.createElement('span');
            let Phone_Number = document.createElement('span');
            let Email = document.createElement('span');
            let Opening_Hours = document.createElement('span');
            let Cuisine_Type = document.createElement('span');
            let Dietary_Options = document.createElement('span');
            let Service_Type = document.createElement('span');
            let Comments = document.createElement('span');
            let cross = document.createElement('div');

            li.setAttribute('data-id', doc.id);
            Restaurant_Name.textContent = doc.data().Restaurant_Name;
            Address.textContent = doc.data().Address;
            Phone_Number.textContent = doc.data().Phone_Number;
            Email.textContent = doc.data().Email;
            Opening_Hours.textContent = doc.data().Opening_Hours;
            Cuisine_Type.textContent = doc.data().Cuisine_Type;
            Dietary_Options.textContent = doc.data().Dietary_Options;
            Service_Type.textContent = doc.data().Service_Type;
            Comments.textContent = doc.data().Comments;
            cross.textContent = 'x';
            cross.style.cursor = 'pointer'; // Thêm con trỏ chuột cho dấu x

            li.appendChild(Restaurant_Name);
            li.appendChild(Address);
            li.appendChild(Phone_Number);
            li.appendChild(Email);
            li.appendChild(Opening_Hours);
            li.appendChild(Cuisine_Type);
            li.appendChild(Dietary_Options);
            li.appendChild(Service_Type);
            li.appendChild(Comments);
            li.appendChild(cross);

            restaurantList.appendChild(li);

            // Handle delete
            cross.addEventListener('click', async (e) => {
                e.stopPropagation();
                let id = e.target.parentElement.getAttribute('data-id'); // Lấy ID từ thuộc tính data-id
                if (id) {
                    try {
                        // Sử dụng doc() để tạo tham chiếu đến tài liệu
                        const docRef = doc(db, 'Food', id);
                        await deleteDoc(docRef); // Xóa tài liệu
                        console.log('Document successfully deleted'); // In thông báo thành công
                    } catch (error) {
                        console.error('Error removing document: ', error); // In lỗi nếu có
                    }
                } else {
                    console.log('No document id found'); // In thông báo nếu không tìm thấy ID
                }
            });
        }

        // Real-time listener using onSnapshot
        onSnapshot(foodCollection, (snapshot) => {
            // Làm mới danh sách nhà hàng mỗi khi có thay đổi
            restaurantList.innerHTML = ''; // Xóa nội dung cũ
            snapshot.forEach(doc => {
                renderStorePage(doc);
            });
        });

        // Add new restaurant
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                await addDoc(foodCollection, {
                    Restaurant_Name: form.Restaurant_Name.value,
                    Address: form.Address.value,
                    Phone_Number: form.Phone_Number.value,
                    Email: form.Email.value,
                    Opening_Hours: form.Opening_Hours.value,
                    Cuisine_Type: form.Cuisine_Type.value,
                    Dietary_Options: form.Dietary_Options.value,
                    Service_Type: form.Service_Type.value,
                    Comments: form.Comments.value
                });

                // Clear the form fields after successful submission
                form.Restaurant_Name.value = '';
                form.Address.value = '';
                form.Phone_Number.value = '';
                form.Email.value = '';
                form.Opening_Hours.value = '';
                form.Cuisine_Type.value = '';
                form.Dietary_Options.value = '';
                form.Service_Type.value = '';
                form.Comments.value = '';

                console.log("Document added successfully");
            } catch (error) {
                console.error("Error adding document: ", error);
            }
        });
    </script>
</body>

</html>
